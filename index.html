<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login und Registrierung mit Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js"></script>
</head>
<body>

    <h1>Benutzerregistrierung und Anmeldung</h1>
    
    <!-- Registrierung Formular -->
    <div>
        <h2>Registrieren</h2>
        <form id="registerForm">
            <label for="registerEmail">E-Mail:</label>
            <input type="email" id="registerEmail" required><br><br>
            <label for="registerPassword">Passwort:</label>
            <input type="password" id="registerPassword" required><br><br>
            <button type="submit">Registrieren</button>
        </form>
    </div>
    
    <!-- Login Formular -->
    <div>
        <h2>Anmelden</h2>
        <form id="loginForm">
            <label for="loginEmail">E-Mail:</label>
            <input type="email" id="loginEmail" required><br><br>
            <label for="loginPassword">Passwort:</label>
            <input type="password" id="loginPassword" required><br><br>
            <button type="submit">Anmelden</button>
        </form>
    </div>

    <script>
        // Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyDQuc4HvfX4NHl98NT_6VOs4OcquNSVGQM",
            authDomain: "test-7ab6b.firebaseapp.com",
            databaseURL: "https://test-7ab6b-default-rtdb.firebaseio.com",
            projectId: "test-7ab6b",
            storageBucket: "test-7ab6b.firebasestorage.app",
            messagingSenderId: "615765179356",
            appId: "1:615765179356:web:97e52cfba0741ebb8c6d19"
        };

        // Firebase initialisieren
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Registrierung Formular
        document.getElementById("registerForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    user.sendEmailVerification()
                        .then(() => {
                            alert("Eine Bestätigungs-E-Mail wurde gesendet!");
                        })
                        .catch(error => {
                            console.error("Fehler beim Senden der Bestätigungs-E-Mail:", error);
                        });

                    // Benutzer in Realtime Database speichern
                    const userRef = database.ref('users/' + user.uid);
                    userRef.set({
                        email: email,
                        createdAt: Date.now()
                    });

                    alert("Benutzer erfolgreich registriert!");
                })
                .catch(error => {
                    console.error("Fehler bei der Registrierung:", error);
                });
        });

        // Login Formular
        document.getElementById("loginForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;

                    // Überprüfen, ob die E-Mail des Benutzers verifiziert wurde
                    if (user.emailVerified) {
                        alert("Erfolgreich angemeldet!");

                        // Weiterleitung zu 'weiterleiten.html'
                        window.location.href = "weiterleiten.html";
                    } else {
                        alert("Bitte bestätigen Sie zuerst Ihre E-Mail!");
                    }
                })
                .catch(error => {
                    console.error("Fehler beim Anmelden:", error);
                    alert("Fehler beim Anmelden! Überprüfen Sie Ihre E-Mail und Ihr Passwort.");
                });
        });
    </script>
</body>
</html>
