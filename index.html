<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Registrierung mit Firebase</title>
    <!-- Firebase SDK einbinden -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
</head>
<body>
    <h2>Login</h2>
    <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="E-Mail" required><br>
        <input type="password" id="loginPassword" placeholder="Passwort" required><br>
        <button onclick="login()">Einloggen</button>
        <p><a href="javascript:showRegister()">Noch kein Konto? Registriere dich hier!</a></p>
    </div>

    <h2 id="registerHeader" style="display:none;">Registrierung</h2>
    <div id="registerForm" style="display:none;">
        <input type="email" id="registerEmail" placeholder="E-Mail" required><br>
        <input type="password" id="registerPassword" placeholder="Passwort" required><br>
        <button onclick="register()">Registrieren</button>
        <p><a href="javascript:showLogin()">Bereits ein Konto? Melde dich hier an!</a></p>
    </div>

    <script>
        // Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyCtfBgOnp5YZ2xtPzXQ5TqDwAinUIBE1hc",
            authDomain: "test-9a798.firebaseapp.com",
            projectId: "test-9a798",
            storageBucket: "test-9a798.firebasestorage.app",
            messagingSenderId: "134538517366",
            appId: "1:134538517366:web:f575ecaa372b28bf767857"
        };

        // Firebase initialisieren
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Zeige das Login-Formular
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('registerHeader').style.display = 'none';
        }

        // Zeige das Registrierungs-Formular
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('registerHeader').style.display = 'block';
        }

        // Registrierung
        function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    alert('Registrierung erfolgreich! Bitte überprüfe deine E-Mails.');

                    // E-Mail-Verifizierung senden
                    user.sendEmailVerification()
                        .then(() => {
                            alert('Verifizierungs-E-Mail gesendet!');
                            showLogin(); // Zurück zum Login
                        })
                        .catch((error) => {
                            console.error('Fehler beim Senden der E-Mail-Verifizierung:', error.message);
                            alert('Fehler beim Senden der E-Mail-Verifizierung. Versuch es später erneut.');
                        });
                })
                .catch((error) => {
                    console.error('Registrierungsfehler:', error.message);
                    alert('Fehler bei der Registrierung: ' + error.message);
                });
        }

        // Login
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;

                    // Überprüfen, ob der Benutzer seine E-Mail verifiziert hat
                    if (!user.emailVerified) {
                        alert('Bitte bestätige deine E-Mail-Adresse, bevor du dich anmelden kannst.');
                        auth.signOut(); // Benutzer ausloggen
                    } else {
                        alert('Erfolgreich eingeloggt!');
                        // Hier kannst du die Weiterleitung oder ein Dashboard einfügen
                    }
                })
                .catch((error) => {
                    console.error('Login-Fehler:', error.message);
                    alert('Fehler beim Login: ' + error.message);
                });
        }
    </script>
</body>
</html>
