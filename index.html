<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kommentare</title>

    <!-- Firebase SDK einbinden (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js";

        // Funktion zum Laden der Firebase-Konfiguration aus der config.json
        fetch('config.json')
            .then(response => response.json())
            .then(config => {
                // Firebase-Konfiguration
                const firebaseConfig = config;

                // Firebase initialisieren
                const app = initializeApp(firebaseConfig);
                const database = getDatabase(app);

                // Kommentare laden
                function loadComments() {
                    const commentsRef = ref(database, "comments");
                    onValue(commentsRef, (snapshot) => {
                        const comments = snapshot.val();
                        const commentsContainer = document.getElementById("commentsContainer");
                        commentsContainer.innerHTML = ""; // Alte Kommentare löschen

                        if (comments) {
                            // Kommentare aus der Firebase-Datenbank holen und anzeigen
                            for (let id in comments) {
                                const comment = comments[id];
                                const div = document.createElement("div");
                                div.innerHTML = `<strong>${comment.username}</strong>: <p>${comment.comment}</p><hr>`;
                                commentsContainer.appendChild(div);
                            }
                        }
                    });
                }

                loadComments();

                // Kommentar absenden
                document.getElementById("commentForm").addEventListener("submit", function(event) {
                    event.preventDefault();

                    const username = document.getElementById("username").value;
                    const commentText = document.getElementById("comment").value;

                    if (username && commentText) {
                        const commentsRef = ref(database, "comments");
                        const newCommentRef = push(commentsRef);
                        set(newCommentRef, {
                            username: username,
                            comment: commentText
                        });

                        // Felder zurücksetzen
                        document.getElementById("username").value = "";
                        document.getElementById("comment").value = "";
                    }
                });
            })
            .catch(error => {
                console.error('Fehler beim Laden der Firebase-Konfiguration:', error);
            });
    </script>
</head>
<body>
    <h1>Kommentare</h1>
    
    <!-- Formular zum Hinterlassen eines Kommentars -->
    <form id="commentForm">
        <label for="username">Name:</label>
        <input type="text" id="username" required><br><br>
        <label for="comment">Kommentar:</label><br>
        <textarea id="comment" rows="4" cols="50" required></textarea><br><br>
        <button type="submit">Kommentar absenden</button>
    </form>

    <h2>Kommentare:</h2>
    <div id="commentsContainer"></div>
</body>
</html>
